name: Conway Game of Life

on:
  schedule:
    - cron: "0 */6 * * *"
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'
          
      - name: Install dependencies
        run: |
          pip install pillow numpy cairosvg
          
      - name: Generate Game of Life
        run: |
          python - << 'EOF'
          import random
          import math
          
          # Создаём SVG с анимацией Game of Life
          width, height = 800, 200
          cell_size = 8
          cols, rows = width // cell_size, height // cell_size
          
          # Генерируем случайную начальную конфигурацию
          grid = [[random.choice([0, 1]) for _ in range(cols)] for _ in range(rows)]
          
          svg = f'''<svg width="{width}" height="{height}" xmlns="http://www.w3.org/2000/svg">
            <rect width="{width}" height="{height}" fill="#0d1117"/>
            <defs>
              <style>
                @keyframes blink {{
                  0%, 100% {{ opacity: 1; }}
                  50% {{ opacity: 0.3; }}
                }}
                .cell {{
                  animation: blink 2s ease-in-out infinite;
                }}
              </style>
            </defs>
          '''
          
          colors = ['#00F7FF', '#00D4FF', '#00B3FF', '#0092FF', '#0071FF']
          
          for i in range(rows):
              for j in range(cols):
                  if grid[i][j]:
                      color = colors[random.randint(0, len(colors)-1)]
                      delay = random.uniform(0, 2)
                      svg += f'<rect class="cell" x="{j*cell_size}" y="{i*cell_size}" width="{cell_size-1}" height="{cell_size-1}" fill="{color}" style="animation-delay: {delay}s"/>\n'
          
          svg += '</svg>'
          
          with open('game-of-life.svg', 'w') as f:
              f.write(svg)
          EOF
          
      - name: Commit and push
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add game-of-life.svg
          git commit -m "Update Game of Life" || exit 0
          git push
